<!DOCTYPE html>
<html>
<!-- start right frame -->
	<head>
		<title>CDOL Disciple Log Entries</title>
		~[wc:commonscripts]
		<link href="/images/css/screen.css" rel="stylesheet" media="screen">
		<link href="/images/css/print.css" rel="stylesheet" media="print">
		~[wc:pscb_init]
	</head>
	<body>
	<!-- breadcrumb start -->
		~[wc:admin_header_frame_css]<a href="/admin/home.html" target="_top">Start Page</a> &gt; <a href="/admin/reports/home.html">Reports</a> &gt; <a href="/admin/reports_pscb/pscb_home.html">PSCB Custom Reports</a> &gt; <a href="/admin/reports_pscb/PSCB_logs.html">Log Entries</a> &gt; CDOL Disciple Log Entries~[wc:admin_navigation_frame_css]
		<!-- breadcrumb end -->
		<h1>CDOL Log Disciple Log Entries</h1>
		<!-- start of Options -->
		<form id="rptFilters" action="#" method="POST">
			<div class="box-round" style="overflow: hidden;">
				<h2>Report Filters</h2>
				<table border="0" cellspacing="0" cellpadding="0" class="linkDescList">
					<tr class="headerrow">
						<th style="white-space: nowrap;" width="10px">&nbsp;Students To View</th>
						<th style="white-space: nowrap;" width="10px">Start Date</th>
						<th style="white-space: nowrap;" width="10px">End Date</th>
						<th style="white-space: nowrap;" width="10px">Discipline Sub-Type</th>
						<!--<th style="white-space: nowrap;" width="10px">Incident Type</th>-->
						<th style="white-space: nowrap;" width="100%">Consequence Taken</th>
					</tr>
					<tr class="headerrow">
						<td style="height:30px">
							<select name="se">
								<option value="all">All Students</option>
								<option ~[if.~[gpv:se]=cur]selected[/if] value="cur">Current Selection (~[x:studsinset])</option>
							</select>
						</td>
						<td style="white-space: nowrap;">
							<input name="sd" id="sd" type="text" value="~[if.~[gpv:sd] > 1/1/1900]~[gpv:sd][else]~[tlist_sql;SELECT MIN(FirstDay) FROM Terms WHERE to_char(SchoolID) LIKE CASE WHEN ~(curschoolid) = 0 THEN '%' ELSE to_char(~(curschoolid)) END AND to_char(ID) LIKE CASE WHEN ~(curschoolid) = 0 THEN '%' ELSE to_char(~(curtermid)) END AND YearID = ~(curyearid)]~(firstday;d)[/tlist_sql][/if]" size="15" maxlength="10" class="psDateWidget">
						</td>
						<td style="white-space: nowrap;">
							<input name="ed" id="ed" type="text" value="~[if.~[gpv:ed] > 1/1/1900]~[gpv:ed][else]~[eaodate][/if]" size="15" maxlength="10" class="psDateWidget">
						</td>
						<td>
							<select name="ist">
								<option value="" ~[if.~[gpv:ist]=]selected[/if]>All Incident Sub-Types</option>
								~[tlist_sql;
								SELECT st.Value id, CASE WHEN st.value = '~[gpv:ist]' THEN 'selected' ELSE '' END isSelected,
								Trim(dbms_lob.SubStr(st.valuet,100,1)) name
								FROM gen lt
								INNER JOIN gen st ON (lt.id = st.name)
								WHERE lt.cat = 'logtype' AND st.cat = 'subtype' AND lt.name = 'Discipline'
								ORDER BY Trim(dbms_lob.SubStr(st.valuet,100,1))]
								<option value="~(id;t)" ~(isSelected)>~(name;t) (~(id;t))</option>
								[/tlist_sql]
							</select>
						</td>
						<!--<td>-->
						<!--	<select name="it">-->
						<!--		<option value="" ~[if.~[gpv:it]=]selected[/if]>All Incident Types</option>-->
						<!--		~[tlist_sql;-->
						<!--		WITH incidtype AS (-->
						<!--		SELECT  REGEXP_SUBSTR ((SELECT Translate(Translate(valuet2, chr(13), CHR(124)), chr(10), CHR(124)) from gen where cat = 'logentrycodes' and name = 'Discipline_IncidentType'), Chr(91)||Chr(94)||Chr(124)||Chr(93)||Chr(43), 1, LEVEL) name-->
						<!--		FROM DUAL-->
						<!--		CONNECT BY REGEXP_SUBSTR ((SELECT Translate(Translate(valuet2, chr(13), CHR(124)), chr(10), CHR(124)) from gen where cat = 'logentrycodes' and name = 'Discipline_IncidentType'), Chr(91)||Chr(94)||Chr(124)||Chr(93)||Chr(43), 1, LEVEL) IS NOT NULL)-->
						<!--		SELECT Trim(SubStr(name,1,InStr(name,CHR(59))-1)) id, CASE WHEN SubStr(name,1,InStr(name,CHR(59))-1) = '~[gpv:it]' THEN 'selected' ELSE '' END isSelected, SubStr(name,InStr(name,CHR(59))+1) name-->
						<!--		FROM incidtype-->
						<!--		WHERE SubStr(name,1,InStr(name,CHR(59))-1) IS NOT NULL-->
						<!--		ORDER BY 2]-->
						<!--		<option value="~(id;t)" ~(isSelected)>~(name;t) (~(id;t))</option>-->
						<!--		[/tlist_sql]-->
						<!--	</select>-->
						<!--</td>-->
						<td>
							<select name="act">
								<option value="" ~[if.~[gpv:act]=]selected[/if]>All Consequence Taken</option>
								~[tlist_sql;
								WITH actiontaken AS (
								SELECT  REGEXP_SUBSTR ((SELECT Translate(Translate(valuet2, chr(13), CHR(124)), chr(10), CHR(124)) from gen where cat = 'logentrycodes' and name = 'Discipline_ActionTaken'), Chr(91)||Chr(94)||Chr(124)||Chr(93)||Chr(43), 1, LEVEL) name
								FROM DUAL
								CONNECT BY REGEXP_SUBSTR ((SELECT Translate(Translate(valuet2, chr(13), CHR(124)), chr(10), CHR(124)) from gen where cat = 'logentrycodes' and name = 'Discipline_ActionTaken'), Chr(91)||Chr(94)||Chr(124)||Chr(93)||Chr(43), 1, LEVEL) IS NOT NULL)
								SELECT SubStr(name,1,InStr(name,CHR(59))-1) id, CASE WHEN SubStr(name,1,InStr(name,CHR(59))-1) = '~[gpv:act]' THEN 'selected' ELSE '' END isSelected, SubStr(name,InStr(name,CHR(59))+1) name
								FROM actiontaken
								WHERE SubStr(name,1,InStr(name,CHR(59))-1) IS NOT NULL
								ORDER BY 2]
								<option value="~(id;t)" ~(isSelected)>~(name;t) (~(id;t))</option>
								[/tlist_sql]
							</select>
						</td>
						</td>
					</tr>
				</table>
				<div class="button-row" style="float: left;">
					<input type="hidden" name="showData" value="1">
					<span class="red">&nbsp;&nbsp;Select parameters and click submit</span>
					<input type="hidden" name="ac" value="prim">~[submitbutton]
				</div>
			</div>
		</form>

<!-- start of content and bounding box -->
		~[if#showData.~[gpv:showData]=1]
		<div class="box-round">
			<h2>Discipline Log Entries<span><label id="lblRecordCount"></label></span></h2>
			<table class="tablesorter grid" id="results">
				<thead>
					<tr bgcolor="#f6f6f6">
					<!--
						<th class="bold">ID</th>
						<th class="bold">DCID</th>
						<th class="bold">Discipline Type</th>
					-->
						<th class="bold">Entry Details</th>
						<th class="bold">Student Number</th>
						<th class="bold">Student Name</th>
						<th class="bold">Grade Level</th>
						<th class="bold">Gender</th>
						<th class="bold">Entry Date</th>
						<th class="bold">Author</th>
						<th class="bold">Sub Type</th>
						<th class="bold">Title</th>
						<th class="bold">Description</th>
						<th class="bold">Consequence Date</th>
						<th class="bold">Consequence</th>
					</tr>
				</thead>
				<tbody>
					~[tlist_sql;
					WITH ActionTaken AS (
					SELECT  REGEXP_SUBSTR ((SELECT Translate(Translate(valuet2, chr(13), CHR(124)), chr(10), CHR(124)) from gen where cat = 'logentrycodes' and name = 'Discipline_ActionTaken'), Chr(91)||Chr(94)||Chr(124)||Chr(93)||Chr(43), 1, LEVEL) name
					FROM DUAL
					CONNECT BY REGEXP_SUBSTR ((SELECT Translate(Translate(valuet2, chr(13), CHR(124)), chr(10), CHR(124)) from gen where cat = 'logentrycodes' and name = 'Discipline_ActionTaken'), Chr(91)||Chr(94)||Chr(124)||Chr(93)||Chr(43), 1, LEVEL) IS NOT NULL)
					, ActionTakenList AS (
					SELECT SubStr(name,1,InStr(name,CHR(59))-1) id, SubStr(name,InStr(name,CHR(59))+1) name
					FROM actiontaken
					WHERE SubStr(name,1,InStr(name,CHR(59))-1) IS NOT NULL)
					, IncidentType AS (
					SELECT  REGEXP_SUBSTR ((SELECT Translate(Translate(valuet2, chr(13), CHR(124)), chr(10), CHR(124)) from gen where cat = 'logentrycodes' and name = 'Discipline_IncidentType'), Chr(91)||Chr(94)||Chr(124)||Chr(93)||Chr(43), 1, LEVEL) name
					FROM DUAL
					CONNECT BY REGEXP_SUBSTR ((SELECT Translate(Translate(valuet2, chr(13), CHR(124)), chr(10), CHR(124)) from gen where cat = 'logentrycodes' and name = 'Discipline_IncidentType'), Chr(91)||Chr(94)||Chr(124)||Chr(93)||Chr(43), 1, LEVEL) IS NOT NULL)
					, IncidentTypeList AS (
					SELECT SubStr(name,1,InStr(name,CHR(59))-1) id, SubStr(name,InStr(name,CHR(59))+1) name
					FROM IncidentType
					WHERE SubStr(name,1,InStr(name,CHR(59))-1) IS NOT NULL)
					, SubType AS (
					SELECT st.Value id, Trim(dbms_lob.SubStr(st.valuet,100,1)) name
					FROM gen lt
					INNER JOIN gen st ON (lt.id = st.name)
					WHERE lt.cat = 'logtype' AND st.cat = 'subtype' AND lt.name = 'Discipline')
					SELECT	lg.dcid log_dcid, s.dcid, s.student_number, s.lastfirst, s.grade_level, s.gender,
					lg.entry_date, lg.entry_author, st.name subtype, lg.Subject, lg.entry, lg.Discipline_ActionDate, act.name ActionTaken
					FROM  log lg
					INNER JOIN students s ON (lg.studentid = s.id)
					INNER JOIN gen ON (lg.LogTypeID = gen.id AND gen.cat = 'logtype' AND gen.name = 'Discipline')
					LEFT OUTER JOIN subtype st ON (lg.SubType = st.id)
					LEFT OUTER JOIN IncidentTypeList it ON (TRIM(lg.Discipline_IncidentType) = TRIM(it.id))
					LEFT OUTER JOIN ActionTakenList act ON (TRIM(lg.Discipline_ActionTaken) = TRIM(act.id))
					~[if#se.~[gpv:se]=cur] INNER JOIN ~[temp.table.current.selection:students] temp ON (s.dcid = temp.dcid)  [/if#se]
					WHERE s.schoolid = ~(curschoolid)
					AND lg.Discipline_IncidentDate  >= to_date('~[gpv:sd]','MM/DD/YYYY')
					AND lg.Discipline_IncidentDate  <= to_date('~[gpv:ed]','MM/DD/YYYY')
						~[if#ist.~[gpv:ist]#]AND lg.subtype = '~[gpv:ist]'[/if#ist]
						~[if#it.~[gpv:it]#]AND lg.Discipline_IncidentType = '~[gpv:it]'[/if#it]
						~[if#act.~[gpv:act]#]AND lg.Discipline_ActionTaken = '~[gpv:act]'[/if#act]
    					ORDER BY lg.entry_date desc
					   ;alternatecolor;nonemessage=
					<tr nodata><td colspan="100%">No Records Found.</td></tr>]
					<tr class="Record">
						<td><a href="/admin/reports_pscb/logs/customlogentrydetails.html?frn=008~(log_dcid)&curstudid=~(dcid;t)" target="_blank">View</a>
						</td>
						<td>~(student_number;t)</td>
						<td class="nowrap"><a href="/admin/students/log.html?frn=001~(dcid;t)" target="_blank">~(lastfirst)</a></td>
						<td>~(grade_level)</td>
						<td>~(gender)</td>
						<td>~(entry_date;d)</td>
						<td class="nowrap">~(entry_author)</td>
						<td>~(Subtype)</td>
						<td>~(entry)</td>
						<td>~(title)</td>
						<td>~(Discipline_ActionDate;d)</td>
						<td>~(Action)</td>
					</tr>
					[/tlist_sql]
				</tbody>
			</table>
		</div>
		<p align="center">Report generated at ~[time] on ~[date]</p>
		[/if#showData]
		~[wc:admin_footer_frame_css]
	</body>
</html>